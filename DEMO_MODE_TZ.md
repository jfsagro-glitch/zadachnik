# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
на разработку демо-версии системы «CURSOR Pipeline»
Версия 2.0 с демо-режимом и развертыванием на Glitch

---

## 1. КОНЦЕПЦИЯ ДЕМО-РЕЖИМА

### 1.1. Цели демо-режима
- Предоставить возможность тестирования системы без регистрации
- Показать все ключевые функции системы за 15–30 минут
- Создать реалистичную бизнес-среду с тестовыми данными
- Обеспечить изоляцию данных между разными демо‑пользователями

### 1.2. Сценарии использования демо‑режима
- HR‑менеджер: оценка системы для внедрения в отдел
- Руководитель: знакомство с аналитикой и отчётностью
- Исполнитель: тестирование интерфейса и рабочих процессов
- Бизнес‑заказчик: оценка прозрачности процессов

---

## 2. АРХИТЕКТУРА ДЕМО-РЕЖИМА

### 2.1. Высокоуровневый обзор
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │    Backend      │    │   Database      │
│                 │    │                 │    │                 │
│ - React/App     │◄──►│ - Demo Manager  │◄──►│ - PostgreSQL/   │
│ - Demo Router   │    │ - Session Ctrl  │    │   SQLite (Glitch)│
│ - Guest Access  │    │ - Data Factory  │    │ - Schema/sandbox│
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2. Механизм демо‑сессий
- Временные пользователи: автоматическая генерация при входе в демо
- Изоляция данных (вариант 1 — предпочтительный): песочница по сессии (отдельная схема/пространство данных, привязка ко `session_id`)
- Тайм‑аут: завершение сессии через 2 часа (конфигурируемо)
- Сессионные cookie/token: хранение идентификатора демо‑сессии
- Авто‑очистка: удаление старых сессий по расписанию (например, каждые 6–24 ч)

Примечание: на первом этапе допускается «единое демо‑пространство» с ручным сбросом, затем миграция к полной изоляции по сессии.

---

## 3. ТЕСТОВЫЕ ДАННЫЕ ДЛЯ ДЕМО-РЕЖИМА

### 3.1. Структура демо‑организации
- Подразделения: IT отдел, HR отдел, Маркетинг
- Роли: исполнитель, супервайзер, руководитель, бизнес‑пользователь

#### 3.1.1. Подразделения (пример)
```json
[
  { "id": "dep-it", "name": "IT отдел", "supervisor": "Мария Сидорова", "employee_count": 8 },
  { "id": "dep-hr", "name": "HR отдел", "supervisor": "Анна Козлова", "employee_count": 5 },
  { "id": "dep-marketing", "name": "Отдел маркетинга", "supervisor": "Дмитрий Петров", "employee_count": 6 }
]
```

#### 3.1.2. Демо‑пользователи (пример)
```json
{
  "executors": [
    { "id": "user-1", "name": "Иван Петров", "email": "i.petrov@demo-cursor.ru", "department": "dep-it", "position": "Frontend разработчик", "workload": 65 },
    { "id": "user-2", "name": "Елена Коваль", "email": "e.koval@demo-cursor.ru", "department": "dep-it", "position": "Backend разработчик", "workload": 85 }
  ],
  "supervisors": [
    { "id": "user-10", "name": "Мария Сидорова", "email": "m.sidorova@demo-cursor.ru", "department": "dep-it", "position": "Руководитель IT отдела" }
  ],
  "business_users": [
    { "id": "user-20", "name": "Ольга Новикова", "email": "o.novikova@demo-cursor.ru", "department": "dep-sales", "position": "Менеджер по продажам" }
  ]
}
```

### 3.2. Демо‑задачи
- Категории: подбор, разработка, маркетинг, операционные
- Не менее 10 задач в разных статусах/приоритетах и сроках

Примеры:
```json
[
  {
    "id": "task-1",
    "title": "Подбор Senior Frontend разработчика",
    "description": "Поиск и отбор кандидатов на позицию Senior Frontend с опытом React 3+ лет",
    "status": "in_progress",
    "priority": "high",
    "assignee": "user-1",
    "creator": "user-10",
    "due_date": "2024-06-15",
    "business_request": "HR-001",
    "estimated_hours": 40,
    "actual_hours": 28,
    "tags": ["recruitment", "frontend", "urgent"]
  },
  {
    "id": "task-2",
    "title": "Разработка модуля аналитики",
    "description": "Создание дашборда для отслеживания KPI сотрудников",
    "status": "review",
    "priority": "medium",
    "assignee": "user-2",
    "creator": "user-10",
    "due_date": "2024-06-10",
    "business_request": "DEV-045",
    "estimated_hours": 60,
    "actual_hours": 55,
    "tags": ["development", "analytics", "internal"]
  }
]
```

---

## 4. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ ДЕМО-РЕЖИМА

### 4.1. Вход в демо‑режим
- На главной странице: кнопки «Войти» и «Демо‑режим»
- При нажатии «Демо‑режим»: создаётся временный пользователь с ролью «Супервайзер», выполняется авто‑вход и редирект на дашборд
- Опционально: «Быстрый старт» (авто‑роль), «Выбор роли», «Тур по системе»

ASCII‑макет главной страницы:
```
┌─────────────────────────────────────────────────────────────┐
│                🚀 CURSOR Pipeline Demo                      │
│                                                             │
│   [Кнопка: Демо-режим]        [Кнопка: Регистрация]         │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                  Возможности системы:                 │  │
│  │  • Управление задачами и заявками                     │  │
│  │  • Мониторинг загрузки сотрудников                    │  │
│  │  • Аналитика и KPI в реальном времени                 │  │
│  │  • Цветовая маркировка и уведомления                  │  │
│  │  • Ролевая модель доступа                             │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 4.2. Демо‑интерфейс
- Явный индикатор «ДЕМО‑РЕЖИМ» (баннер/водяной знак)
- Таймер сессии (2 часа) с предупреждениями, кнопка «Продлить»
- Кнопка «Сбросить демо‑данные» — откат к исходному состоянию без перезагрузки страницы
- Возможность регистрации из демо и переход в реальный режим

### 4.3. Ограничения демо‑режима
- Запрет опасных операций с реальными данными (в демо все временно)
- Без приглашения реальных пользователей, без внешних интеграций
- Лимиты: до 100 задач/сессию (конфигурабельно)

---

## 5. МЕТРИКИ И АНАЛИТИКА

### 5.1. Демо‑метрики (пример)
```js
const demoMetrics = {
  productivity: { tasks_completed: 45, tasks_overdue: 3, completion_rate: 93.8, avg_completion_time: '2.3 дня' },
  workload: { total_workload: 72, optimal_range: '60-85%', overloaded_users: 2, underloaded_users: 1 },
  efficiency: { planned_vs_actual: 95.2, quality_score: 88.7, employee_satisfaction: 82.1 }
}
```
- Графики: загрузка отделов (обновление каждые 30с), воронка статусов, тепловая карта продуктивности
- «Живые» дашборды: метрики меняются при действиях пользователя

---

## 6. ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ И API

### 6.1. Варианты изоляции данных
- Вариант 1 (предпочтительно): изоляция по сессии (session‑sandbox)
- Вариант 2: единое демо‑пространство + периодический сброс (каждые 2–24 ч)
- Вариант 3: отдельная БД для демо + сброс по расписанию/запросу

### 6.2. Жизненный цикл демо‑сессии (вариант 1)
- Создание: временный пользователь (роль «Супервайзер»), копирование эталонных данных
- Работа: все изменения помечаются `session_id`/`creator_id`
- Сброс: удаление пользовательских данных + восстановление эталона
- Завершение: удаление временного пользователя и его данных (или авто‑очистка по CRON)

### 6.3. Изменения в базе данных
- Таблица `users`: добавить `is_temporary` (boolean), `demo_expires_at` (timestamp)
- Таблица `tasks`: либо `is_demo` (boolean), либо полная привязка к `creator_id`/`session_id`
- Эталонные демо‑данные: «immutable» источник для копирования

### 6.4. Endpoints (унифицировано)
Основные:
- `POST /api/demo/sessions` — создание новой демо‑сессии
- `GET /api/demo/sessions/:id` — получение данных сессии
- `DELETE /api/demo/sessions/:id` — завершение демо‑сессии
- `POST /api/demo/sessions/:id/reset` — сброс данных к исходному состоянию

Совместимость с ранее предложенными:
- `POST /api/v1/demo/start` → алиас `POST /api/demo/sessions`
- `POST /api/v1/demo/reset` → алиас `POST /api/demo/sessions/:id/reset`
- `POST /api/v1/demo/extend` → продление срока `expires_at`

Быстрые действия:
- `POST /api/demo/quick-tasks`
- `POST /api/demo/load-scenario`
- `POST /api/demo/generate-metrics`

---

## 7. ИНТЕРФЕЙС ДЕМО-РЕЖИМА

### 7.1. Панель демо‑режима (UI)
```
┌─────────────────────────────────────────────────────────────┐
│ 🚀 ДЕМО-РЕЖИМ | Роль: Супервайзер | Время: 01:59:30         │
│ [Быстрые действия] [Сбросить данные] [Тур по системе]       │
└─────────────────────────────────────────────────────────────┘
```
- Водяной знак «ДЕМО‑РЕЖИМ», таймер сессии, кнопки быстрых сценариев

### 7.2. Интерактивные подсказки (пример)
```js
const demoGuides = {
  first_visit: [
    "Добро пожаловать в CURSOR Pipeline!",
    "Здесь вы можете протестировать все функции системы",
    "Используйте быстрые действия для ускорения знакомства"
  ],
  task_creation: [
    "Создайте свою первую задачу",
    "Назначьте исполнителя и установите срок",
    "Отслеживайте прогресс в реальном времени"
  ]
}
```

---

## 8. КРИТЕРИИ ПРИЁМКИ

### 8.1. Функциональные тесты
- Создание и изоляция демо‑сессий
- Генерация эталонных данных при старте
- Корректные роли и права
- Работа быстрых действий и сценариев
- Автоматическая очистка по таймауту

### 8.2. UX‑тесты
- Интуитивный вход в демо‑режим
- Понятные подсказки и гид
- Реалистичные тестовые данные
- Отзывчивость интерфейса

### 8.3. Производительность
- Создание демо‑сессии < 3 с
- Генерация тестовых данных < 5 с
- Отклик интерфейса < 1 с
- 50+ одновременных демо‑сессий

---

## 9. РАЗВЁРТЫВАНИЕ И ХОСТИНГ (ОБЩЕЕ)
- Бэкенд: Node.js 18+ (или существующий стек)
- БД: PostgreSQL (основная), SQLite для Glitch
- Контейнеризация: опционально Docker
- Балансировщик: Nginx (для основного прод‑окружения)

---

## 10. МОНИТОРИНГ И АНАЛИТИКА ИСПОЛЬЗОВАНИЯ
- Метрики демо‑сессий: новые сессии/день, средняя длительность, популярные роли, конверсия в регистрацию
- Сбор обратной связи: опрос по завершении демо, рейтинг удобства, предложения
- Аналитика поведения: heatmap, трекер сценариев

---

## 11. ПЛАН ВНЕДРЕНИЯ

### 11.1. Этап 1: Базовая система (2 недели)
- Реализация демо‑сессий и изоляции данных
- Создание базовых тестовых данных
- Настройка демо‑окружения

### 11.2. Этап 2: Расширенные возможности (3 недели)
- Генератор тестовых данных
- Интерактивные сценарии и туры
- Система быстрых действий

### 11.3. Этап 3: Полировка и оптимизация (2 недели)
- UI/UX улучшения
- Нагрузочное тестирование
- Сбор и анализ метрик

---

# 12. РАЗВЁРТЫВАНИЕ НА GLITCH ЧЕРЕЗ GITHUB (repo: `jfsagro-glitch/zadachnik`)

## 12.1. Интеграция с GitHub репозиторием

### 12.1.1. Структура репозитория (пример)
```
zadachnik/
├── .env.example                 # Шаблон переменных окружения
├── .glitchdotcom.json           # Конфигурация Glitch
├── package.json                 # Зависимости и скрипты
├── server.js                    # Основной серверный файл
├── public/                      # Статические файлы фронтенда
│   ├── index.html
│   ├── css/
│   ├── js/
│   └── assets/
├── src/
│   ├── backend/
│   │   ├── routes/
│   │   ├── models/
│   │   ├── database/
│   │   └── middleware/
│   └── frontend/
│       ├── components/
│       └── utils/
└── README.md                    # Инструкция по развертыванию
```

### 12.1.2. Конфигурация Glitch (`.glitchdotcom.json` пример)
```json
{
  "install": "npm install",
  "start": "node server.js",
  "watch": {
    "install": { "include": ["\\.json$"] },
    "restart": { "include": ["\\.js$"] }
  }
}
```

## 12.2. Технические требования для Glitch
- Платформенные ограничения: RAM 512 MB, хранилище ~512 MB (временное), авто‑сон при простое
- Автодомен `*.glitch.me`, Node.js контейнер
- Адаптация: SQLite вместо PostgreSQL, ограничение активных демо‑сессий, авто‑очистка каждые 6 ч

## 12.3. Настройка сервера для Glitch

### 12.3.1. `server.js` (пример)
```js
const express = require('express');
const path = require('path');
const app = express();
const PORT = process.env.PORT || 3000;

app.use(express.json());
app.use(express.static('public'));

// API Routes (демо)
app.use('/api/demo', require('./src/backend/routes/demo'));
app.use('/api/tasks', require('./src/backend/routes/tasks'));
app.use('/api/users', require('./src/backend/routes/users'));

// SPA fallback
app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

app.listen(PORT, () => {
  console.log(`CURSOR Pipeline Demo running on port ${PORT}`);
});
```

### 12.3.2. `package.json` (пример)
```json
{
  "name": "cursor-pipeline-demo",
  "version": "1.0.0",
  "description": "Demo version of CURSOR Pipeline task management system",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "init-db": "node src/backend/scripts/init-demo-db.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "sqlite3": "^5.1.6",
    "cors": "^2.8.5",
    "helmet": "^7.0.0",
    "compression": "^1.7.4",
    "uuid": "^9.0.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  },
  "engines": { "node": ">=18.0.0" }
}
```

## 12.4. Автоматическое развертывание
- Импорт репозитория `jfsagro-glitch/zadachnik` в Glitch
- Включение синхронизации с GitHub (деплой при push в `main`)
- Настройка переменных окружения через панель Glitch

Переменные окружения (пример):
```
NODE_ENV=production
DEMO_SESSION_TIMEOUT=2h
MAX_CONCURRENT_SESSIONS=10
DEMO_DATA_REFRESH_INTERVAL=6h
```

## 12.5. Адаптация базы данных для Glitch (SQLite)

### 12.5.1. Инициализация БД (пример)
```js
// src/backend/database/db.js
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const dbPath = process.env.NODE_ENV === 'production' ? '/tmp/demo_sessions.db' : './demo_sessions.db';
const db = new sqlite3.Database(dbPath, (err) => {
  if (err) console.error('Error opening database:', err);
  else {
    console.log('Connected to SQLite database');
    initializeDatabase();
  }
});

function initializeDatabase() {
  db.run(`CREATE TABLE IF NOT EXISTS demo_sessions (
    id TEXT PRIMARY KEY,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    expires_at DATETIME,
    user_data TEXT,
    task_data TEXT
  )`);
}

module.exports = db;
```

### 12.5.2. Оптимизация под ограничения
- До 50 задач на сессию
- Сжатие JSON при хранении
- Регулярное удаление завершённых сессий

## 12.6. Мониторинг и логирование
- Логи в консоли Glitch (`console.log`/`console.error`)
- Периодический лог использования памяти каждые 5 минут
- Сообщение «приложение просыпается» при первом запросе

## 12.7. Инструкция по развертыванию
1) Fork `jfsagro-glitch/zadachnik` на GitHub
2) Glitch → New Project → Import from GitHub → URL форка
3) Настроить ENV в Glitch
4) Открыть выданный `*.glitch.me` URL и протестировать демо‑сессию
5) Включить авто‑синхронизацию с GitHub

## 12.8. Резервное копирование и восстановление
- Ежедневный экспорт демо‑данных в JSON (сохранение в отдельной ветке)
- Скрипт `src/backend/scripts/backup.js` для экспорта/восстановления

## 12.9. Доменная структура (Glitch)
- Основной URL: `https://cursor-pipeline-demo.glitch.me`
- Резервный: `https://zadachnik-cursor.glitch.me`
- Пользовательский домен (опционально): `demo.cursor-pipeline.ru`

## 12.10. Ограничения Glitch и обход
- Автосон (5 минут простоя): допустимо для демо; опционально — ping‑сервис (uptimerobot)
- Ограничения RAM/диска: ограничить объём демо‑данных, быстрая инициализация
- Временное хранилище: хранить данные в `/tmp`, готовность к сбросу

---

# 13. ТЕСТИРОВАНИЕ НА GLITCH

## 13.1. Чеклист
- Импорт из GitHub успешен, зависимости установлены
- Сервер стартует без ошибок, доступен по `*.glitch.me`
- Демо‑сессии создаются и изолируются
- Генерация тестовых данных корректна
- Автосинхронизация с GitHub включена

## 13.2. Мониторинг производительности
- Метрики: время отклика, память, активные сессии, частота перезапусков
- Инструменты: консоль Glitch, логи в реальном времени

---

# 14. ДОКУМЕНТАЦИЯ ДЛЯ GLITCH‑РАЗВЁРТЫВАНИЯ

## 14.1. README (выдержка)
```markdown
# CURSOR Pipeline — Демо версия

## Быстрый старт на Glitch
1. New Project → Import from GitHub → URL репозитория
2. Glitch установит зависимости и запустит сервер на PORT
3. Откройте выданный `*.glitch.me` URL и нажмите «Демо‑режим»

## Локальная разработка
npm install
npm run dev
```

---

# 15. ПЛАН МИГРАЦИИ НА GLITCH

## 15.1. Этап 1: Подготовка (3 дня)
- Адаптация БД под SQLite
- Оптимизация памяти
- Создание конфигурации для Glitch

## 15.2. Этап 2: Развёртывание (2 дня)
- Импорт репозитория в Glitch
- Настройка ENV
- Тестирование базового функционала

## 15.3. Этап 3: Оптимизация (2 дня)
- Автосинхронизация с GitHub
- Пинг‑сервис (опционально)
- Мониторинг и настройка производительности

---

## Подписи сторон
Исполнитель: _________________________ / [ФИО] /
Заказчик: ____________________________ / [ФИО] /
Дата: «___» ___________ 2024 г.

---

## Примечания по реализации
- На первом этапе допустим «единый демо‑контур» + кнопка «Сбросить демо‑данные»
- Целевое решение — изоляция по сессии (вариант 1)
- Для совместимости API предусмотрены алиасы `v1`/`/api/demo/sessions`

